# =============================================================================
# SÄ‚PTÄ‚MÃ‚NA 20: PROGRAMARE PARALELÄ‚ È˜I CONCURENTÄ‚ - Dockerfile
# =============================================================================
# Curs: Algoritmi È™i Tehnici de Programare (ATP)
# Academia de Studii Economice BucureÈ™ti - CSIE
# =============================================================================

FROM ubuntu:22.04

LABEL maintainer="ATP Course - ASE CSIE"
LABEL description="Mediu de dezvoltare pentru programare paralelÄƒ È™i concurentÄƒ Ã®n C"
LABEL version="1.0"

# Evitare prompt-uri interactive
ENV DEBIAN_FRONTEND=noninteractive

# Instalare pachete necesare
RUN apt-get update && apt-get install -y \
    # Compilatoare È™i build tools
    gcc \
    g++ \
    make \
    cmake \
    # Debugging È™i profiling
    gdb \
    valgrind \
    linux-tools-generic \
    # UtilitÄƒÈ›i
    vim \
    nano \
    less \
    tree \
    htop \
    # Python pentru vizualizÄƒri
    python3 \
    python3-pip \
    python3-matplotlib \
    python3-numpy \
    # DocumentaÈ›ie
    man-db \
    manpages-posix-dev \
    # CurÄƒÈ›are cache
    && rm -rf /var/lib/apt/lists/*

# Instalare pachete Python pentru benchmark visualization
RUN pip3 install --no-cache-dir \
    matplotlib \
    numpy \
    pandas

# Setare director de lucru
WORKDIR /workspace

# Copiere fiÈ™iere proiect
COPY . /workspace/

# Setare permisiuni
RUN chmod -R 755 /workspace

# Compilare proiect
RUN make all 2>/dev/null || true

# Variabile de mediu pentru threading
ENV OMP_NUM_THREADS=4
ENV PTHREAD_STACK_SIZE=8388608

# Mesaj de Ã®ntÃ¢mpinare
RUN echo '#!/bin/bash' > /entrypoint.sh && \
    echo 'echo ""' >> /entrypoint.sh && \
    echo 'echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"' >> /entrypoint.sh && \
    echo 'echo "â•‘  ðŸ§µ SÄ‚PTÄ‚MÃ‚NA 20: PROGRAMARE PARALELÄ‚ È˜I CONCURENTÄ‚                           â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•‘     Mediu de dezvoltare Docker                                                â•‘"' >> /entrypoint.sh && \
    echo 'echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"' >> /entrypoint.sh && \
    echo 'echo "â•‘  Comenzi utile:                                                               â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•‘    make              - CompileazÄƒ proiectul                                   â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•‘    make run          - RuleazÄƒ exemplul demonstrativ                          â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•‘    make demo         - DemonstraÈ›ie completÄƒ                                  â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•‘    make benchmark    - RuleazÄƒ benchmark paralel vs secvenÈ›ial               â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•‘    make helgrind     - VerificÄƒ race conditions                              â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•‘    make help         - Ajutor complet                                        â•‘"' >> /entrypoint.sh && \
    echo 'echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"' >> /entrypoint.sh && \
    echo 'echo ""' >> /entrypoint.sh && \
    echo 'exec "$@"' >> /entrypoint.sh && \
    chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
CMD ["/bin/bash"]
