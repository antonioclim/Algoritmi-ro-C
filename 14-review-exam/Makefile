# =============================================================================
# SÄ‚PTÄ‚MÃ‚NA 14: RECAPITULARE AVANSATÄ‚ È˜I OPTIMIZARE - Makefile
# Algoritmi È™i Tehnici de Programare (ATP) - ASE BucureÈ™ti
# =============================================================================
#
# Acest Makefile oferÄƒ automatizare completÄƒ pentru compilare, testare È™i
# verificarea memoriei. SuportÄƒ toate exerciÈ›iile È™i exemplele sÄƒptÄƒmÃ¢nii.
#
# Utilizare:
#   make          - CompileazÄƒ toate targeturile
#   make run      - RuleazÄƒ exemplul principal
#   make test     - ExecutÄƒ testele automate
#   make valgrind - VerificÄƒ memory leaks
#   make clean    - È˜terge fiÈ™ierele generate
#   make help     - AfiÈ™eazÄƒ acest meniu
#
# =============================================================================

# Compilator È™i opÈ›iuni
CC = gcc
CFLAGS = -Wall -Wextra -std=c11 -g -O2
CFLAGS_DEBUG = -Wall -Wextra -std=c11 -g -O0 -DDEBUG
LDFLAGS = -lm

# Directoare
SRC_DIR = src
DATA_DIR = data
TEST_DIR = tests
SOL_DIR = solution
SLIDES_DIR = slides

# Coduri de culori ANSI
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[0;33m
BLUE = \033[0;34m
MAGENTA = \033[0;35m
CYAN = \033[0;36m
WHITE = \033[0;37m
BOLD = \033[1m
NC = \033[0m

# Simboluri
CHECK = âœ“
CROSS = âœ—
ARROW = â†’
GEAR = âš™
ROCKET = ğŸš€
WARNING = âš 
BOOK = ğŸ“š
TEST_ICON = ğŸ§ª
MEMORY = ğŸ’¾
CLEAN_ICON = ğŸ§¹

# Targeturi principale
TARGETS = example1 exercise1 exercise2
SOLUTIONS = exercise1_sol exercise2_sol homework1_sol homework2_sol

# =============================================================================
# TARGET PRINCIPAL
# =============================================================================

.PHONY: all clean run test valgrind help demo solutions debug info

all: banner $(TARGETS)
	@echo ""
	@echo "$(GREEN)$(BOLD)$(CHECK) Toate targeturile au fost compilate cu succes!$(NC)"
	@echo ""

banner:
	@echo ""
	@echo "$(CYAN)$(BOLD)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(CYAN)$(BOLD)â•‘     SÄ‚PTÄ‚MÃ‚NA 14: RECAPITULARE AVANSATÄ‚ È˜I OPTIMIZARE                     â•‘$(NC)"
	@echo "$(CYAN)$(BOLD)â•‘     Algoritmi È™i Tehnici de Programare - ASE BucureÈ™ti                    â•‘$(NC)"
	@echo "$(CYAN)$(BOLD)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""

# =============================================================================
# COMPILARE EXEMPLE È˜I EXERCIÈšII
# =============================================================================

example1: $(SRC_DIR)/example1.c
	@echo "$(CYAN)$(GEAR) Compilare example1...$(NC)"
	@$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS)
	@echo "$(GREEN)  $(CHECK) example1 compilat cu succes$(NC)"

exercise1: $(SRC_DIR)/exercise1.c
	@echo "$(CYAN)$(GEAR) Compilare exercise1 (Order Management System)...$(NC)"
	@$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS) 2>&1 | head -20 || true
	@if [ -f exercise1 ]; then \
		echo "$(GREEN)  $(CHECK) exercise1 compilat cu succes$(NC)"; \
	else \
		echo "$(YELLOW)  $(WARNING) exercise1 are erori de compilare (TODOs necompletate)$(NC)"; \
	fi

exercise2: $(SRC_DIR)/exercise2.c
	@echo "$(CYAN)$(GEAR) Compilare exercise2 (Social Network Analyzer)...$(NC)"
	@$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS) 2>&1 | head -20 || true
	@if [ -f exercise2 ]; then \
		echo "$(GREEN)  $(CHECK) exercise2 compilat cu succes$(NC)"; \
	else \
		echo "$(YELLOW)  $(WARNING) exercise2 are erori de compilare (TODOs necompletate)$(NC)"; \
	fi

# =============================================================================
# COMPILARE SOLUÈšII (pentru instructori)
# =============================================================================

solutions: banner $(SOLUTIONS)
	@echo ""
	@echo "$(GREEN)$(BOLD)$(CHECK) Toate soluÈ›iile au fost compilate!$(NC)"
	@echo ""

exercise1_sol: $(SOL_DIR)/exercise1_sol.c
	@echo "$(MAGENTA)$(GEAR) Compilare soluÈ›ie exercise1...$(NC)"
	@$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS)
	@echo "$(GREEN)  $(CHECK) exercise1_sol compilat$(NC)"

exercise2_sol: $(SOL_DIR)/exercise2_sol.c
	@echo "$(MAGENTA)$(GEAR) Compilare soluÈ›ie exercise2...$(NC)"
	@$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS)
	@echo "$(GREEN)  $(CHECK) exercise2_sol compilat$(NC)"

homework1_sol: $(SOL_DIR)/homework1_sol.c
	@echo "$(MAGENTA)$(GEAR) Compilare soluÈ›ie homework1...$(NC)"
	@$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS)
	@echo "$(GREEN)  $(CHECK) homework1_sol compilat$(NC)"

homework2_sol: $(SOL_DIR)/homework2_sol.c
	@echo "$(MAGENTA)$(GEAR) Compilare soluÈ›ie homework2...$(NC)"
	@$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS)
	@echo "$(GREEN)  $(CHECK) homework2_sol compilat$(NC)"

# =============================================================================
# RULARE
# =============================================================================

run: example1
	@echo ""
	@echo "$(YELLOW)$(BOLD)$(ROCKET) Rulare exemplu principal...$(NC)"
	@echo "$(CYAN)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€$(NC)"
	@./example1
	@echo "$(CYAN)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€$(NC)"
	@echo ""

run-ex1: exercise1
	@echo ""
	@echo "$(YELLOW)$(BOLD)$(ROCKET) Rulare Exercise 1...$(NC)"
	@echo "$(CYAN)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€$(NC)"
	@./exercise1 < $(DATA_DIR)/orders.txt 2>&1 || echo "$(RED)$(CROSS) Eroare la rulare$(NC)"
	@echo ""

run-ex2: exercise2
	@echo ""
	@echo "$(YELLOW)$(BOLD)$(ROCKET) Rulare Exercise 2...$(NC)"
	@echo "$(CYAN)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€$(NC)"
	@./exercise2 $(DATA_DIR)/social_network.csv 2>&1 || echo "$(RED)$(CROSS) Eroare la rulare$(NC)"
	@echo ""

demo: example1
	@echo ""
	@echo "$(MAGENTA)$(BOLD)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(MAGENTA)$(BOLD)â•‘            DEMONSTRAÈšIE COMPLETÄ‚ - SÄ‚PTÄ‚MÃ‚NA 14               â•‘$(NC)"
	@echo "$(MAGENTA)$(BOLD)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@./example1
	@echo ""
	@echo "$(GREEN)$(BOLD)$(CHECK) DemonstraÈ›ie completÄƒ!$(NC)"
	@echo ""

# =============================================================================
# TESTARE AUTOMATÄ‚
# =============================================================================

test: banner
	@echo "$(YELLOW)$(BOLD)$(TEST_ICON) Rulare teste automate...$(NC)"
	@echo ""
	@PASS=0; FAIL=0; \
	echo "$(CYAN)â”€â”€ Test 1: Order Management System â”€â”€$(NC)"; \
	if [ -f exercise1_sol ]; then \
		./exercise1_sol < $(TEST_DIR)/test1_input.txt > /tmp/test1_output.txt 2>&1; \
		if diff -q /tmp/test1_output.txt $(TEST_DIR)/test1_expected.txt > /dev/null 2>&1; then \
			echo "$(GREEN)  $(CHECK) Test 1 PASSED$(NC)"; \
			PASS=$$((PASS+1)); \
		else \
			echo "$(RED)  $(CROSS) Test 1 FAILED$(NC)"; \
			echo "$(YELLOW)    DiferenÈ›e:$(NC)"; \
			diff $(TEST_DIR)/test1_expected.txt /tmp/test1_output.txt | head -10; \
			FAIL=$$((FAIL+1)); \
		fi; \
	else \
		echo "$(YELLOW)  $(WARNING) exercise1_sol nu existÄƒ (compilaÈ›i mai Ã®ntÃ¢i cu 'make solutions')$(NC)"; \
	fi; \
	echo ""; \
	echo "$(CYAN)â”€â”€ Test 2: Social Network Analyzer â”€â”€$(NC)"; \
	if [ -f exercise2_sol ]; then \
		./exercise2_sol $(DATA_DIR)/social_network.csv < $(TEST_DIR)/test2_input.txt > /tmp/test2_output.txt 2>&1; \
		if diff -q /tmp/test2_output.txt $(TEST_DIR)/test2_expected.txt > /dev/null 2>&1; then \
			echo "$(GREEN)  $(CHECK) Test 2 PASSED$(NC)"; \
			PASS=$$((PASS+1)); \
		else \
			echo "$(RED)  $(CROSS) Test 2 FAILED$(NC)"; \
			echo "$(YELLOW)    DiferenÈ›e:$(NC)"; \
			diff $(TEST_DIR)/test2_expected.txt /tmp/test2_output.txt | head -10; \
			FAIL=$$((FAIL+1)); \
		fi; \
	else \
		echo "$(YELLOW)  $(WARNING) exercise2_sol nu existÄƒ$(NC)"; \
	fi; \
	echo ""; \
	echo "$(CYAN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"; \
	echo "$(BOLD)Rezultate: $(GREEN)$$PASS passed$(NC) $(RED)$$FAIL failed$(NC)"; \
	echo "$(CYAN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"

test-quick: example1
	@echo "$(YELLOW)$(TEST_ICON) Test rapid pe exemplu...$(NC)"
	@./example1 > /dev/null 2>&1 && echo "$(GREEN)$(CHECK) Exemplu ruleazÄƒ corect$(NC)" || echo "$(RED)$(CROSS) Eroare$(NC)"

# =============================================================================
# VERIFICARE MEMORIE CU VALGRIND
# =============================================================================

valgrind: example1
	@echo ""
	@echo "$(YELLOW)$(BOLD)$(MEMORY) Verificare memorie cu Valgrind...$(NC)"
	@echo "$(CYAN)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€$(NC)"
	@valgrind --leak-check=full \
	          --show-leak-kinds=all \
	          --track-origins=yes \
	          --verbose \
	          --error-exitcode=1 \
	          ./example1 2>&1 | grep -E "(definitely|indirectly|possibly|still reachable|ERROR SUMMARY|All heap)" || true
	@echo "$(CYAN)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€$(NC)"
	@echo ""

valgrind-full: example1
	@echo ""
	@echo "$(YELLOW)$(BOLD)$(MEMORY) Verificare memorie completÄƒ cu Valgrind...$(NC)"
	@echo ""
	@valgrind --leak-check=full \
	          --show-leak-kinds=all \
	          --track-origins=yes \
	          --verbose \
	          ./example1

valgrind-sol: solutions
	@echo ""
	@echo "$(YELLOW)$(BOLD)$(MEMORY) Verificare memorie pentru soluÈ›ii...$(NC)"
	@echo ""
	@for sol in $(SOLUTIONS); do \
		if [ -f $$sol ]; then \
			echo "$(CYAN)â”€â”€ Verificare $$sol â”€â”€$(NC)"; \
			valgrind --leak-check=full --error-exitcode=1 ./$$sol < $(TEST_DIR)/test1_input.txt > /dev/null 2>&1 && \
				echo "$(GREEN)  $(CHECK) $$sol: No memory leaks$(NC)" || \
				echo "$(RED)  $(CROSS) $$sol: Memory leaks detected$(NC)"; \
		fi; \
	done
	@echo ""

# =============================================================================
# DEBUG BUILD
# =============================================================================

debug: CFLAGS = $(CFLAGS_DEBUG)
debug: clean all
	@echo ""
	@echo "$(MAGENTA)$(BOLD)$(GEAR) Build pentru debugging complet!$(NC)"
	@echo "$(YELLOW)  Utilizare: gdb ./example1$(NC)"
	@echo ""

# =============================================================================
# CURÄ‚ÈšARE
# =============================================================================

clean:
	@echo ""
	@echo "$(YELLOW)$(CLEAN_ICON) CurÄƒÈ›are fiÈ™iere generate...$(NC)"
	@rm -f $(TARGETS) $(SOLUTIONS)
	@rm -f *.o *.out
	@rm -f /tmp/test*_output.txt
	@echo "$(GREEN)$(CHECK) CurÄƒÈ›are completÄƒ!$(NC)"
	@echo ""

clean-all: clean
	@echo "$(YELLOW)$(CLEAN_ICON) CurÄƒÈ›are totalÄƒ (inclusiv backup-uri)...$(NC)"
	@rm -f *~ *.bak
	@rm -f $(SRC_DIR)/*~ $(SOL_DIR)/*~
	@echo "$(GREEN)$(CHECK) CurÄƒÈ›are totalÄƒ completÄƒ!$(NC)"

# =============================================================================
# INFORMAÈšII È˜I HELP
# =============================================================================

info:
	@echo ""
	@echo "$(CYAN)$(BOLD)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(CYAN)$(BOLD)â•‘              INFORMAÈšII SÄ‚PTÄ‚MÃ‚NA 14                           â•‘$(NC)"
	@echo "$(CYAN)$(BOLD)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(BOLD)TemÄƒ:$(NC) Recapitulare AvansatÄƒ È™i Optimizare"
	@echo ""
	@echo "$(BOLD)Structuri de date acoperite:$(NC)"
	@echo "  â€¢ Arrays, Linked Lists, Stacks, Queues"
	@echo "  â€¢ Binary Trees, BST, AVL Trees"
	@echo "  â€¢ Heaps, Hash Tables, Graphs"
	@echo ""
	@echo "$(BOLD)Algoritmi acoperiÈ›i:$(NC)"
	@echo "  â€¢ Sortare: QuickSort, MergeSort, HeapSort"
	@echo "  â€¢ CÄƒutare: Binary Search, BFS, DFS"
	@echo "  â€¢ Grafuri: Dijkstra, Bellman-Ford"
	@echo ""
	@echo "$(BOLD)FiÈ™iere:$(NC)"
	@echo "  $(CYAN)src/example1.c$(NC)     - Exemplu complet (demonstraÈ›ie)"
	@echo "  $(CYAN)src/exercise1.c$(NC)    - Order Management System (12 TODOs)"
	@echo "  $(CYAN)src/exercise2.c$(NC)    - Social Network Analyzer (15 TODOs)"
	@echo ""
	@echo "$(BOLD)PrezentÄƒri:$(NC)"
	@echo "  $(CYAN)slides/presentation-week14.html$(NC)      - Prezentare principalÄƒ"
	@echo "  $(CYAN)slides/presentation-comparativ.html$(NC)  - ComparaÈ›ie limbaje"
	@echo ""

help:
	@echo ""
	@echo "$(CYAN)$(BOLD)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(CYAN)$(BOLD)â•‘                    COMENZI DISPONIBILE                         â•‘$(NC)"
	@echo "$(CYAN)$(BOLD)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(BOLD)Compilare:$(NC)"
	@echo "  $(GREEN)make$(NC)              CompileazÄƒ toate exerciÈ›iile"
	@echo "  $(GREEN)make solutions$(NC)    CompileazÄƒ soluÈ›iile (instructor)"
	@echo "  $(GREEN)make debug$(NC)        Build cu simboluri pentru debugging"
	@echo ""
	@echo "$(BOLD)Rulare:$(NC)"
	@echo "  $(GREEN)make run$(NC)          RuleazÄƒ exemplul principal"
	@echo "  $(GREEN)make run-ex1$(NC)      RuleazÄƒ Exercise 1"
	@echo "  $(GREEN)make run-ex2$(NC)      RuleazÄƒ Exercise 2"
	@echo "  $(GREEN)make demo$(NC)         DemonstraÈ›ie completÄƒ"
	@echo ""
	@echo "$(BOLD)Testare:$(NC)"
	@echo "  $(GREEN)make test$(NC)         RuleazÄƒ testele automate"
	@echo "  $(GREEN)make test-quick$(NC)   Test rapid pe exemplu"
	@echo ""
	@echo "$(BOLD)Debugging:$(NC)"
	@echo "  $(GREEN)make valgrind$(NC)     Verificare scurtÄƒ memory leaks"
	@echo "  $(GREEN)make valgrind-full$(NC) Verificare completÄƒ Valgrind"
	@echo "  $(GREEN)make valgrind-sol$(NC) Verificare soluÈ›ii"
	@echo ""
	@echo "$(BOLD)UtilitÄƒÈ›i:$(NC)"
	@echo "  $(GREEN)make clean$(NC)        È˜terge executabilele"
	@echo "  $(GREEN)make clean-all$(NC)    È˜terge toate fiÈ™ierele generate"
	@echo "  $(GREEN)make info$(NC)         InformaÈ›ii despre sÄƒptÄƒmÃ¢na curentÄƒ"
	@echo "  $(GREEN)make help$(NC)         AfiÈ™eazÄƒ acest meniu"
	@echo ""
	@echo "$(BOLD)Exemplu flux de lucru:$(NC)"
	@echo "  1. $(CYAN)make$(NC)              # CompileazÄƒ"
	@echo "  2. $(CYAN)make run$(NC)          # RuleazÄƒ exemplul"
	@echo "  3. $(CYAN)make valgrind$(NC)     # VerificÄƒ memoria"
	@echo "  4. $(CYAN)make test$(NC)         # TesteazÄƒ soluÈ›iile"
	@echo ""

# =============================================================================
# REGULI SPECIALE
# =============================================================================

# Previne È™tergerea fiÈ™ierelor intermediare
.PRECIOUS: $(TARGETS) $(SOLUTIONS)

# DeclarÄƒ targeturile care nu sunt fiÈ™iere
.PHONY: all clean run test valgrind help demo solutions debug info \
        run-ex1 run-ex2 test-quick valgrind-full valgrind-sol \
        clean-all banner
